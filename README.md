# lexi — офлайн-тренажёр немецких существительных

**Как веб-приложение** [https://x6prl.github.io/lexi/](https://x6prl.github.io/lexi/), через меню вашего браузера вы можете добавить себе ярлык на  экран телефона.

`lexi` — однофайловое (single-file), полностью офлайн web-приложение для тренировки немецких существительных. Все данные и статистика хранятся локально в браузере (IndexedDB), никаких серверов и аккаунтов. Лёгкое, быстрое, дружелюбное к мобильным экранам \~6.3". Вайбкод на 80+%.

Интерфейс оптимизирован под использование на смартфоне одной рукой (правой). * **Скорость** прохождения заданий была одной из важнейших характеристик при проектировании UX. Не более пяти элементов выбора — это позволяет охватывать их одним взглядом.

С версии **2.1.0** появилась бета-модуль для немецких **глаголов**: отдельная карточка, собственная статистика и импорт из JSON (см. ниже).

## Основные возможности

* **3 режима обучения** (от простого к сложному): `MC5` → `CHUNKS` → `COMPOSE`.
* **Каждое упражнение = 3 этапа**: выбор артикля → сборка слова → выбор множественного числа.
* **Умное планирование показа**: интервальное повторение на базе «полужизни» знания (Delta-Log-Stability), целевая надёжность `τ=0.9`, индивидуальная стабильность по режимам.
* **Полностью офлайн**: хранение в IndexedDB, импорт/экспорт в удобном текстовом формате.
* **Гибкая выдача**: баланс охвата (coverage) и закрепления, «забывание» хорошо выученных слов.

### Глаголы (beta)

* Новый экран **Verben (beta)** на главной странице.
* Импорт/экспорт набора глаголов — JSON со структурой `lemma`, `morph`, `frames` и слотами карточки. Пример — `verbs/demo.json`.
* Каждая карточка = 5 «слотов»: падеж/предлог, лемма, Präteritum, Perfekt (aux + Partizip II), коллокация/микропрактика.
* Индивидуальная статистика хранится в IndexedDB (новые objectStore: `verbs`, `frames`, `vstats` и др.) и планируется через Delta-Log-Stability (`τ=0.9`).

---

## Режимы упражнений

Каждое упражнение проходит **3 этапа**: артикль → сборка слова → множественное число.

1. **MC5** — выбор слова из 5 (только одно верно), остальные 4 — случайные из БД.
2. **CHUNKS** — слово разбивается на чанки длиной 1–3; на каждом шаге `keypad` предлагает 1 верный и 4–5 «похожих» вариантов (учёт заглавных, умляутов, z/tz, s/sch и т. п.). Пользователь не знает общего числа чанков; при сборке последнего — автоматический переход дальше.
3. **COMPOSE** — как `CHUNKS`, но выбор посимвольно.

---

## Импорт/Экспорт

Файл-импорт — текст с блоками через пустую строку:

```
term
translation1; translation2;
```

**Пример:**

```
der Hand "-e
рука; кисть (руки)
```

Форматы множественного числа:

```
-        (без изменения)
"-       (только умляут)
"-e      (умляут + e)
"-en     (умляут + en)
"-n      (умляут + n)
-e       (только e)
-en
-n
-nen
-s
-er
"-er     (умляут + er)
```

Экспорт создаёт файл в том же формате (для резервной копии/переноса).

---

## Данные и статистика

```ts
type Mode = 'MC5'|'CHUNKS'|'COMPOSE';

type ModeState = {
  S: number;     // стабильность (полужизнь), дни (>0)
  last: number;  // ts последнего показа (ms)
  due: number;   // ts следующего показа (ms)
  q: number;     // EWMA-точность [0..1]
  streak: number;// серия успехов подряд
};

type TermStatsV2 = {
  id: string;          // termId
  stage: Mode;         // "ведущий" режим
  intro: boolean;      // введено в обучение
  M: ModeState;        // для MC5
  C: ModeState;        // для CHUNKS
  P: ModeState;        // для COMPOSE
};
```

Инициализация при старте: `S ≈ (0.75, 0.60, 0.50)` для (M,C,P), `q=0.5`.

### Ядро планирования (кратко)

* **Вероятность вспоминания** через `Δt` дней:
  `p̂ = 2^(-Δt / S)`
* **Срок показа (due)** при целевой надёжности `τ` (по умолчанию `0.9`):
  `due = last + S * log2(1/τ)`
* **Обновление стабильности** (Delta-Log-Stability):
  `ln S' = ln S + η_mode * g(r, p̂)`, где
  `g(1,p̂) = (1 - p̂)`, `g(0,p̂) = -(p̂ + λ)`, `λ≈0.2`, `η_mode` зависит от режима.
  Ограничения: `S_min=0.25 дн`, `S_max = D_max / log2(1/τ)`, `D_max≈60 дн`.
  После — `due' = now + S' * log2(1/τ)`.
* **Точность и серия**:
  `q' = (1-ρ)q + ρr` (обычно `ρ=0.2`); `streak' = r ? streak+1 : 0`.

**Переходы между режимами** — по порогам стабильности/точности (например, к `CHUNKS`: `S≥3 дн` и `q≥0.85`; к `COMPOSE`: `S≥2 дн` и `q≥0.80`).

**Выбор следующей карточки**: due-множество (+ почти-due с буфером `δ≈0.05`) + новые (`intro=false`) для поддержания coverage. Хорошо выученные слова показываются реже (1–2 мес. минимум разок), новые вводятся по мере «раздолжения».

---

## Настройки по умолчанию

```ts
// Целевая надёжность, буфер почти-due, максимум "забывания"
const τ = 0.9, δ = 0.05, D_max = 60;     // дней
const S_min = 0.25, λ = 0.2, ρ = 0.2;

const η = { MC5: 0.30, CHUNKS: 0.36, COMPOSE: 0.45 };

const initS = { M: 0.75, C: 0.60, P: 0.50 };

const upgrade = {
  toCHUNKS: { minBox: 3, minShown: 5, minAcc: 0.85 },
  toCOMPOSE:{ minBox: 2, minShown: 5, minAcc: 0.80 }
};

const settings /* Settings */ = {
  id: 'singleton',
  leitnerDays: [0,1,3,7,15,30,60],
  toCHUNKS: upgrade.toCHUNKS,
  toCOMPOSE: upgrade.toCOMPOSE,
  maxIntervalDays: 60,
  targetNewShare: 0.15,
  darkTheme: false
};
```
